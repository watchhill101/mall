# 用户管理模块使用说明

## 功能概述

用户管理模块提供了完整的用户管理功能，包括用户列表查看、添加、编辑、删除、权限管理等。

## 主要功能

### 1. 用户列表管理
- ✅ 分页显示用户列表
- ✅ 支持按用户名、邮箱、手机号搜索
- ✅ 支持按状态和角色筛选
- ✅ 批量选择和批量删除

### 2. 用户操作
- ✅ 新增用户
- ✅ 编辑用户信息
- ✅ 删除用户
- ✅ 重置用户密码
- ✅ 管理用户权限

### 3. 统计数据
- ✅ 用户总数统计
- ✅ 活跃用户统计
- ✅ 新注册用户统计
- ✅ VIP用户统计

## 后端接口

### 基础路径
```
/user-management
```

### 接口列表

| 方法 | 路径 | 描述 |
|------|------|------|
| GET | `/users` | 获取用户列表（分页） |
| GET | `/users/:id` | 获取用户详情 |
| POST | `/users` | 创建新用户 |
| PUT | `/users/:id` | 更新用户信息 |
| DELETE | `/users/:id` | 删除用户 |
| DELETE | `/users/batch-delete` | 批量删除用户 |
| PUT | `/users/:id/permissions` | 更新用户权限 |
| PUT | `/users/:id/reset-password` | 重置用户密码 |
| GET | `/stats` | 获取用户统计信息 |

### 用户状态
- `active`: 正常
- `inactive`: 未激活
- `suspended`: 已暂停
- `deleted`: 已删除

### 用户角色
- `admin`: 管理员
- `user`: 普通用户
- `merchant`: 商户
- `operator`: 操作员

## 前端页面

### 页面位置
```
/src/pages/Users/index.jsx
```

### 主要组件
1. **统计卡片**: 显示用户统计信息
2. **搜索筛选栏**: 支持搜索和筛选功能
3. **操作按钮**: 新增、批量删除、刷新
4. **用户表格**: 显示用户列表和操作按钮
5. **编辑弹窗**: 用户信息编辑表单
6. **权限抽屉**: 用户权限管理界面

### 页面路由
```
/system/users
```

## API 使用示例

### 获取用户列表
```javascript
import userManagementAPI from '@/api/userManagement';

const fetchUsers = async () => {
  const response = await userManagementAPI.getUserList({
    page: 1,
    pageSize: 10,
    searchText: 'admin',
    status: 'active',
    role: 'admin'
  });
  console.log(response.data);
};
```

### 创建用户
```javascript
const createUser = async () => {
  const userData = {
    username: 'newuser',
    password: '123456',
    email: 'newuser@mall.com',
    phone: '13800138000',
    role: 'user'
  };
  
  const response = await userManagementAPI.createUser(userData);
  console.log(response.data);
};
```

### 更新用户权限
```javascript
const updatePermissions = async (userId) => {
  const permissions = ['user_management', 'merchant_management'];
  const response = await userManagementAPI.updateUserPermissions(userId, permissions);
  console.log(response.data);
};
```

## 测试数据

运行以下命令初始化测试用户数据：

```bash
cd backend
node scripts/init-user-data.js
```

### 默认测试账号

| 用户名 | 密码 | 邮箱 | 角色 | 状态 |
|--------|------|------|------|------|
| admin | 123456 | admin@mall.com | admin | active |
| merchant1 | 123456 | merchant1@mall.com | merchant | active |
| user1 | 123456 | user1@mall.com | user | active |
| operator1 | 123456 | operator1@mall.com | operator | active |
| user2 | 123456 | user2@mall.com | user | inactive |

## 注意事项

1. **权限验证**: 所有用户管理接口都需要 JWT token 验证
2. **数据验证**: 用户名和邮箱必须唯一
3. **密码安全**: 密码使用 bcrypt 加密存储
4. **软删除**: 建议使用状态标记而非物理删除
5. **权限管理**: 权限变更会影响用户的菜单访问权限

## 扩展功能

### 可以考虑添加的功能
- [ ] 用户头像上传
- [ ] 用户操作日志
- [ ] 密码强度验证
- [ ] 邮箱验证
- [ ] 手机号验证
- [ ] 用户导入导出
- [ ] 角色权限细分
- [ ] 用户组管理

## 故障排除

### 常见问题

1. **401 错误**: 检查是否正确传递 JWT token
2. **数据库连接失败**: 检查 MongoDB 连接配置
3. **重复键错误**: 用户名或邮箱已存在
4. **权限问题**: 确保当前用户有相应的操作权限

### 调试建议

1. 查看浏览器控制台的网络请求
2. 检查后端服务器日志
3. 验证数据库中的用户数据
4. 确认路由配置正确

## 更新日志

### v1.0.0 (2025-08-07)
- ✅ 实现基础用户管理功能
- ✅ 添加用户搜索和筛选
- ✅ 实现权限管理
- ✅ 添加统计数据展示
- ✅ 完善前后端接口对接
